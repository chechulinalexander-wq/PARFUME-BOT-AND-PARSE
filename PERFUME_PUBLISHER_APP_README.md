# 🌸 Perfume Publisher App

GUI приложение для управления публикациями парфюмерных товаров в Telegram канал.

## 🎯 Возможности

### 📦 Управление таблицей товаров
- **Просмотр** всех товаров из базы данных `randewoo_products`
- **Добавление** новых товаров вручную
- **Редактирование** существующих записей (бренд, название, URL)
- **Удаление** товаров из базы
- **Обновление** таблицы одним кликом

### 🤖 Генерация контента через GPT
- Настраиваемый промпт для ChatGPT
- Автоматическая подстановка `{brand}` и `{name}` в промпт
- Использование модели GPT-4o для качественной генерации текста

### 📤 Публикация в Telegram
- Публикация выбранного товара в Telegram канал
- Автоматическое добавление ссылок на Randewoo и Fragrantica
- Индикация прогресса публикации
- Проверка длины сообщения (лимит Telegram)

### ⚙️ Управление настройками
- Хранение API ключей в базе данных
- OpenAI API Key
- Telegram Bot Token
- Telegram Channel ID
- Безопасное хранение (поле ввода скрыто)

## 🚀 Запуск

```bash
python perfume_publisher_app.py
```

## 📋 Интерфейс

### Верхняя панель - Таблица товаров
```
┌─────────────────────────────────────────────────┐
│  ➕ Добавить  ✏️ Редактировать  🗑️ Удалить  🔄 │
├─────┬────────┬─────────┬──────────┬────────────┤
│ ID  │ Бренд  │ Название│ Randewoo │ Fragrantica│
├─────┼────────┼─────────┼──────────┼────────────┤
│ ... │ ...    │ ...     │ ...      │ ...        │
└─────┴────────┴─────────┴──────────┴────────────┘
```

### Нижняя панель
- **Слева**: Промпт для GPT (редактируемый текст)
- **Справа**: 
  - Информация о выбранном товаре
  - Настройки (API ключи)
  - Кнопка "📤 ОПУБЛИКОВАТЬ В TELEGRAM"

## 🔧 Как использовать

### 1. Настройка (первый раз)
1. Запустите приложение
2. Введите API ключи в правой панели:
   - OpenAI API Key
   - Telegram Bot Token
   - Telegram Channel ID
3. Нажмите "💾 Сохранить настройки"

### 2. Редактирование промпта
1. В левой нижней части отредактируйте промпт
2. Используйте `{brand}` и `{name}` для подстановки данных
3. Промпт автоматически сохраняется при публикации

### 3. Публикация товара
1. Выберите товар в таблице (кликните на строку)
2. В правой панели отобразится "✓ Выбрано: ..."
3. Нажмите "📤 ОПУБЛИКОВАТЬ В TELEGRAM"
4. Дождитесь завершения (окно прогресса)
5. Проверьте результат в Telegram канале

### 4. Управление товарами

#### Добавить товар
1. Нажмите "➕ Добавить"
2. Заполните поля:
   - Бренд
   - Название
   - URL Randewoo
   - URL Fragrantica
3. Нажмите "💾 Сохранить"

#### Редактировать товар
1. Выберите товар в таблице
2. Нажмите "✏️ Редактировать"
3. Измените нужные поля
4. Нажмите "💾 Сохранить"

#### Удалить товар
1. Выберите товар в таблице
2. Нажмите "🗑️ Удалить"
3. Подтвердите удаление

## 📝 Формат публикации

Пост в Telegram будет содержать:
```
[Текст, сгенерированный GPT]

🔗 Randewoo: [ссылка]
🌸 Fragrantica: [ссылка]
```

## ⚠️ Важно

- **API ключи** хранятся в базе данных `fragrantica_news.db`
- **Максимальная длина** сообщения Telegram: 4096 символов
- **Рекомендуемая длина** промпта для GPT: до 900 символов
- **Модель GPT**: gpt-4o (требует соответствующий API доступ)

## 🔒 Безопасность

- API ключи скрыты в полях ввода (показываются как •••)
- Ключи хранятся в локальной БД
- Не делитесь файлом `fragrantica_news.db` публично

## 🐛 Решение проблем

### Ошибка "Товар не найден в БД"
- Обновите таблицу кнопкой "🔄 Обновить"
- Проверьте целостность базы данных

### Ошибка "Chat not found"
- Проверьте правильность Channel ID
- Для публичного канала: `@channelname`
- Для приватного: `-100xxxxxxxxxx`
- Убедитесь что бот добавлен в канал как администратор

### Ошибка "Forbidden"
- Добавьте бота в канал
- Сделайте бота администратором
- Дайте права "Post messages"

### GPT не генерирует текст
- Проверьте OpenAI API Key
- Убедитесь в наличии средств на счету OpenAI
- Проверьте доступ к модели gpt-4o

## 💡 Советы

1. **Тестируйте промпты** - начните с простого промпта и улучшайте
2. **Проверяйте длину** - GPT может генерировать слишком длинный текст
3. **Используйте переменные** - `{brand}` и `{name}` делают промпт универсальным
4. **Сохраняйте настройки** - не забудьте сохранить API ключи после ввода
5. **Резервные копии** - делайте бэкапы `fragrantica_news.db`

## 📚 Связанные файлы

- `perfume_publisher_app.py` - главный файл приложения
- `fragrantica_news.db` - база данных (товары + настройки)
- `publish_news.py` - консольная версия (для новостей)
- `test_telegram.py` - проверка настроек Telegram

## 🎨 Пример промпта

```
Представь что ты парфюмерный эксперт и копирайтер. 
Напиши короткий пост для Telegram (максимум 900 символов) о парфюме {brand} {name}.

Стиль:
- Разговорный, теплый, от первого лица
- Короткие абзацы (1-2 строки)
- Сенсорные детали (запахи, ассоциации)
- 2-3 эмодзи максимум
- Закончи вопросом или призывом

Пиши ТОЛЬКО на русском языке.
```

## 📞 Контакты

Если возникли вопросы или ошибки - проверьте:
1. Правильность API ключей
2. Доступ бота к каналу
3. Наличие интернет-соединения
4. Логи в консоли (если запущено через терминал)

